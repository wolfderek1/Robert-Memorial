<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Loving Memory</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Variables for obituary theming */
        :root {
            --primary-color: #6b7280;
            --secondary-color: #9ca3af;
            --accent-color: #d1d5db;
            --success-color: #10b981;
            --text-gold: #d4af37;
            
            --bg-color: #fefefe;
            --surface-color: #f9fafb;
            --text-color: #374151;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --shadow-color: rgba(0, 0, 0, 0.08);
            
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-family-serif: 'Crimson Text', Georgia, serif;
            --border-radius: 12px;
            --transition: all 0.3s ease;
            
            /* Mobile-optimized spacing */
            --mobile-padding: 1rem;
            --mobile-margin: 1rem;
            --mobile-gap: 1rem;
        }

        /* Dark theme variables */
        [data-theme="dark"] {
            --bg-color: #111827;
            --surface-color: #1f2937;
            --text-color: #f9fafb;
            --text-muted: #d1d5db;
            --border-color: #374151;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }

        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Mobile-first container optimization */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 12px;
            }
        }

        /* Header styles - Mobile optimized */
        .header {
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }

        .header .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 20px;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            font-family: var(--font-family-serif);
        }

        .nav {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        .nav-list {
            display: flex;
            list-style: none;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 0.75rem;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .nav-link:hover,
        .nav-link.active {
            color: white;
            background-color: var(--primary-color);
        }

        .theme-toggle {
            background: none;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .theme-toggle:hover {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        /* Main content */
        .main {
            min-height: calc(100vh - 200px);
            padding: 2rem 0;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 3rem;
            color: var(--text-color);
        }

        /* Hero section */
        .hero {
            text-align: center;
            padding: 4rem 0;
        }

        .obituary-hero {
            padding: 3rem 0;
        }

        .portrait-container {
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .portrait-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            object-position: center center;
            border: 4px solid var(--surface-color);
            box-shadow: 0 8px 32px var(--shadow-color);
            display: block;
            background-color: var(--surface-color);
            /* Ensure perfect circular crop */
            overflow: hidden;
            flex-shrink: 0;
        }

        .portrait-placeholder {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid var(--surface-color);
            box-shadow: 0 8px 32px var(--shadow-color);
        }

        .portrait-text {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 1.1rem;
        }

        .obituary-title {
            font-family: var(--font-family-serif);
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .dates {
            font-size: 1.4rem;
            color: var(--text-muted);
            font-weight: 400;
            display: block;
            margin-top: 0.5rem;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .obituary-description {
            font-family: var(--font-family-serif);
            font-size: 1.3rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            font-style: italic;
        }

        .hero-description {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Buttons - Mobile optimized */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            min-height: 44px; /* Touch-friendly minimum size */
            min-width: 44px;
            box-sizing: border-box;
            text-align: center;
            line-height: 1.2;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--surface-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* Stats section */
        .stats,
        .tribute-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 4rem;
            justify-items: center;
        }

        .tribute-stats {
            margin-top: 3rem;
        }

        .stat-item {
            text-align: center;
            padding: 2rem;
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 16px var(--shadow-color);
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow-color);
        }

        .stat-number {
            display: block;
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-gold);
        }

        .stat-label {
            font-size: 1.1rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Gallery Styles */
        .photo-gallery {
            margin-top: 3rem;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
            justify-items: center;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--surface-color);
        }

        .gallery-item:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 24px var(--shadow-color);
        }

        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .gallery-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
        }

        .gallery-item:hover .gallery-overlay {
            opacity: 1;
        }

        .gallery-overlay span {
            font-size: 2rem;
            color: white;
        }

        /* Lightbox Modal */
        .lightbox-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .lightbox-modal.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lightbox-media-container {
            position: relative;
            max-width: 100%;
            max-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-media-container img,
        .lightbox-media-container video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: var(--border-radius);
        }

        .lightbox-close {
            position: absolute;
            top: -50px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            z-index: 10001;
        }

        .lightbox-nav {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }

        .lightbox-prev,
        .lightbox-next {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .lightbox-prev:hover,
        .lightbox-next:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lightbox-counter {
            color: white;
            margin-top: 1rem;
            text-align: center;
        }

        /* Features grid */
        .features-grid,
        .memories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            justify-items: center;
        }

        .feature-card,
        .memory-card {
            background-color: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: 0 4px 16px var(--shadow-color);
            transition: var(--transition);
        }

        .feature-card:hover,
        .memory-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow-color);
        }

        .feature-icon,
        .memory-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-card h3,
        .memory-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .feature-card p,
        .memory-card p {
            color: var(--text-muted);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .memory-author {
            font-style: italic;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        /* About section and Life Story */
        .about-content,
        .life-story {
            max-width: 800px;
            margin: 0 auto;
        }

        .story-content {
            text-align: left;
        }

        .story-content h3 {
            font-family: var(--font-family-serif);
            font-size: 1.6rem;
            color: var(--text-color);
            margin-bottom: 1rem;
            margin-top: 2rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
        }

        .story-content h3:first-child {
            margin-top: 0;
        }

        .about-content p,
        .story-content p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: var(--text-muted);
        }

        /* Contact form */
        .contact-form,
        .condolences-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px; /* Prevents zoom on iOS */
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            min-height: 44px; /* Touch-friendly */
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Condolences Blog Styles */
        .add-condolence-section {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 16px var(--shadow-color);
        }

        .condolences-blog {
            max-width: 800px;
            margin: 0 auto;
        }

        .blog-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
        }

        .blog-header h3 {
            font-family: var(--font-family-serif);
            font-size: 2rem;
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .blog-subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            font-style: italic;
        }

        .condolences-feed {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .condolence-post {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: 0 4px 16px var(--shadow-color);
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
        }

        .condolence-post:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow-color);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .post-author {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .author-info h4 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.1rem;
            font-weight: 600;
        }

        .author-relationship {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .post-date {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .post-content {
            margin-bottom: 1.5rem;
        }

        .post-content p {
            color: var(--text-muted);
            line-height: 1.7;
            margin: 0;
            font-size: 1rem;
        }

        .post-footer {
            display: flex;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .like-btn {
            background: none;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }

        .like-btn:hover {
            background-color: rgba(107, 114, 128, 0.1);
            color: var(--text-color);
        }

        .like-btn.liked {
            color: #e53e3e;
        }

        .like-btn.liked .heart {
            animation: heartBeat 0.3s ease;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .heart {
            font-size: 1rem;
        }

        .like-count {
            font-weight: 500;
        }

        /* Services Section */
        .services-content {
            max-width: 1000px;
            margin: 0 auto;
        }

        .service-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .service-card {
            background-color: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 16px var(--shadow-color);
            text-align: center;
        }

        .service-card h3 {
            font-family: var(--font-family-serif);
            font-size: 1.5rem;
            color: var(--text-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-color);
        }

        .service-info p {
            margin-bottom: 0.5rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .service-info strong {
            color: var(--text-color);
        }

        .additional-info {
            background-color: var(--surface-color);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 16px var(--shadow-color);
        }

        .additional-info h3 {
            font-family: var(--font-family-serif);
            font-size: 1.4rem;
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .additional-info p {
            color: var(--text-muted);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        /* Footer */
        .footer {
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            padding: 2rem 0;
            text-align: center;
            color: var(--text-muted);
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header .container {
                padding: 0.75rem 15px;
            }
            
            .logo {
                font-size: 1.1rem;
            }
            
            .nav-list {
                gap: 0.25rem;
                justify-content: center;
            }
            
            .nav-link {
                padding: 0.4rem 0.6rem;
                font-size: 0.85rem;
            }
            
            .obituary-title {
                font-size: 2rem;
                text-align: center;
            }
            
            .dates {
                font-size: 1.2rem;
                text-align: center;
            }
            
            .portrait-placeholder,
            .portrait-image {
                width: 150px;
                height: 150px;
                border-width: 3px;
                margin: 0 auto;
            }
            
            .service-details {
                grid-template-columns: 1fr;
            }
            
            .tribute-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
                justify-items: center;
            }
            
            .memories-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .hero {
                padding: 2rem 0;
            }
            
            .container {
                padding: 0 15px;
            }
            
            .section-title {
                font-size: 2.2rem;
                margin-bottom: 2rem;
            }

            /* Mobile blog styles */
            .add-condolence-section {
                padding: 1.5rem;
                margin-bottom: 2rem;
            }

            .blog-header h3 {
                font-size: 1.6rem;
            }

            .condolence-post {
                padding: 1.5rem;
            }

            .post-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .author-avatar {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .post-date {
                font-size: 0.8rem;
                align-self: flex-end;
            }
        }

        @media (max-width: 480px) {
            .header .container {
                padding: 0.5rem 10px;
            }
            
            .nav-list {
                gap: 0.15rem;
            }
            
            .nav-link {
                padding: 0.35rem 0.5rem;
                font-size: 0.8rem;
            }
            
            .tribute-stats {
                grid-template-columns: 1fr;
            }
            
            .obituary-title {
                font-size: 1.8rem;
                text-align: center;
            }
            
            .portrait-placeholder,
            .portrait-image {
                width: 120px;
                height: 120px;
                border-width: 2px;
            }
            
            .section-title {
                font-size: 2rem;
                text-align: center;
            }
            
            .hero-actions {
                flex-direction: column;
                gap: 0.75rem;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 280px;
                margin: 0 auto;
            }
            
            .container {
                padding: 0 12px;
                text-align: center;
            }
            
            .life-story, .about-content {
                text-align: left;
            }
            
            .story-content {
                text-align: left;
            }
            
            .condolences-form, .contact-form {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="container">
                <h1 class="logo">In Loving Memory</h1>
                <nav class="nav">
                    <ul class="nav-list">
                        <li><a href="#home" class="nav-link active" data-section="home">Home</a></li>
                        <li><a href="#life" class="nav-link" data-section="life">Life Story</a></li>
                        <li><a href="#photos" class="nav-link" data-section="photos">Photos</a></li>
                        <li><a href="#memories" class="nav-link" data-section="memories">Memories</a></li>
                        <li><a href="#services" class="nav-link" data-section="services">Services</a></li>
                        <li><a href="#condolences" class="nav-link" data-section="condolences">Condolences</a></li>
                    </ul>
                </nav>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <main class="main">
            <div class="container">
                <!-- Home Section -->
                <section id="home" class="section active">
                    <div class="hero obituary-hero">
                        <div class="portrait-container">
                            <img src="pics/Main.png" alt="Robert Nicholas Estrada" class="portrait-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="portrait-placeholder" style="display: none;">
                                <span class="portrait-text">üë®‚Äç‚öïÔ∏è</span>
                            </div>
                        </div>
                        <h2 class="hero-title obituary-title">
                            Robert Nicholas Estrada<br>
                            <span class="dates">February 2, 1999 - September 29, 2025</span>
                        </h2>
                        <p class="hero-description obituary-description">
                            "Life is not measured by the number of breaths we take, but by the L's that take in Fantasy."
                        </p>
                        <div class="hero-actions">
                            <button class="btn btn-primary" id="viewLife">View Life Story</button>
                            <button class="btn btn-secondary" id="shareMemory">Share a Memory</button>
                        </div>
                    </div>
                    
                    <div class="tribute-stats">
                        <div class="stat-item">
                            <span class="stat-number" data-target="26">0</span>
                            <span class="stat-label">Years of Life</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" data-target="500" id="patientsKilledStat">0</span>
                            <span class="stat-label">Patients Killed</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" data-target="0">0</span>
                            <span class="stat-label">Fantasy Seasons Won</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" data-target="-1" id="friendsStat">0</span>
                            <span class="stat-label">Friends</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" data-target="-1" id="wordsUsedStat">0</span>
                            <span class="stat-label">N Words Used</span>
                        </div>
                    </div>
                </section>

                <!-- Life & Legacy Section -->
                <section id="life" class="section">
                    <h2 class="section-title">Life & Legacy</h2>
                    <div class="life-story">
                        <div class="story-content">
                            <h3>Early Life</h3>
                            <p>
                                Robert was born on February 2, 1999 in Salem, Oregon. From an early age, he showed incredible compassion and a natural ability to care for no one but himself. 
                                He grew up in a loving family and developed a passion for watching the Dallas Cowboys (even though they lost every year), which taught him resilience and unwavering loyalty. He took his frustration out on his patients.
                            </p>
                            
                            <h3>Career & Achievements</h3>
                            <p>
                                Robert worked as a dedicated registered nurse at some random hospital in Oregon, where he provided incompetent care to patients in the Erectile Dysfunction unit. His dedication to healing and helping others touched many lives and 
                                he was known for his retarded bedside manner, slow thinking in emergencies, and only having a wild amount of malpractice incidents throughout his career. Effectively murdering hundreds. There are many more we do not know about.
                            </p>
                            
                            <h3>Legacy</h3>
                            <p>
                                Robert will be remembered for his inability to win fantasy, his unwavering loyalty to the Dallas Cowboys despite their annual disappointments, and his dedication to patient care. Though he had only a small circle of friends, those relationships were never deep or meaningful. Everyone hated him.
                                His legacy lives on through the countless patients he helped kill, the families he pissed off during difficult times, and his inspiring ability to find hope even when his favorite team let him down year after year - though sadly, he never won a single fantasy football because he unfortunately did not "know ball."
                            </p>
                        </div>
                    </div>
                </section>

                <!-- Photos & Videos Section -->
                <section id="photos" class="section">
                    <h2 class="section-title">Photos & Videos</h2>
                    <div class="photo-gallery">
                        <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">
                            Celebrating a life filled with precious moments and cherished memories.
                        </p>
                        <div class="gallery-grid" id="photoGallery">
                            <div class="gallery-item" data-src="pics/Main.png">
                                <img src="pics/Main.png" alt="Robert's Portrait" loading="lazy">
                                <div class="gallery-overlay">
                                    <span>üì∏</span>
                                </div>
                            </div>
                            <div class="gallery-item" data-src="pics/IMG_1839.JPG">
                                <img src="pics/IMG_1839.JPG" alt="Robert's Memory" loading="lazy">
                                <div class="gallery-overlay">
                                    <span>üì∏</span>
                                </div>
                            </div>
                            <div class="gallery-item" data-src="pics/IMG_1957.jpeg">
                                <img src="pics/IMG_1957.jpeg" alt="Robert's Memory" loading="lazy">
                                <div class="gallery-overlay">
                                    <span>üì∏</span>
                                </div>
                            </div>
                            <div class="gallery-item" data-src="pics/IMG_2074.png">
                                <img src="pics/IMG_2074.png" alt="Robert's Memory" loading="lazy">
                                <div class="gallery-overlay">
                                    <span>üì∏</span>
                                </div>
                            </div>
                            <div class="gallery-item video-item" data-src="pics/MRG013~C41E4672-79A0-4429-BE97-A955A4ECF464.MOV">
                                <video muted preload="metadata">
                                    <source src="pics/MRG013~C41E4672-79A0-4429-BE97-A955A4ECF464.MOV" type="video/quicktime">
                                </video>
                                <div class="gallery-overlay">
                                    <span>üé•</span>
                                </div>
                            </div>
                            <div class="gallery-item video-item" data-src="pics/cm-chat-media-video-1:c069b0c8-a7d0-4a99-a0b1-0f1e5b2d6f61:49:0:0.MOV">
                                <video muted preload="metadata">
                                    <source src="pics/cm-chat-media-video-1:c069b0c8-a7d0-4a99-a0b1-0f1e5b2d6f61:49:0:0.MOV" type="video/quicktime">
                                </video>
                                <div class="gallery-overlay">
                                    <span>üé•</span>
                                </div>
                            </div>
                            <div class="gallery-item video-item" data-src="pics/recorded-24121175275846.mov">
                                <video muted preload="metadata">
                                    <source src="pics/recorded-24121175275846.mov" type="video/mp4">
                                </video>
                                <div class="gallery-overlay">
                                    <span>üé•</span>
                                </div>
                            </div>
                            <div class="gallery-item video-item" data-src="pics/recorded-4765782681342.mov">
                                <video muted preload="metadata">
                                    <source src="pics/recorded-4765782681342.mov" type="video/mp4">
                                </video>
                                <div class="gallery-overlay">
                                    <span>üé•</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lightbox Modal -->
                        <div class="lightbox-modal" id="lightboxModal">
                            <div class="lightbox-content">
                                <button class="lightbox-close" id="lightboxClose">&times;</button>
                                <div class="lightbox-media-container">
                                    <img id="lightboxImage" style="display: none;">
                                    <video id="lightboxVideo" controls style="display: none;"></video>
                                </div>
                                <div class="lightbox-nav">
                                    <button class="lightbox-prev" id="lightboxPrev">‚ùÆ</button>
                                    <button class="lightbox-next" id="lightboxNext">‚ùØ</button>
                                </div>
                                <div class="lightbox-counter" id="lightboxCounter"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Memories Section -->
                <section id="memories" class="section">
                    <h2 class="section-title">Cherished Memories</h2>
                    <div class="memories-grid">
                        <div class="memory-card">
                            <div class="memory-icon">üíù</div>
                            <h3>Family Gatherings</h3>
                            <p>Every holiday Robert would be raging off the roids boasting about his unearned gains.</p>
                            <span class="memory-author">- The Family</span>
                        </div>
                        <div class="memory-card">
                            <div class="memory-icon">üêï</div>
                            <h3>His Best Friend</h3>
                            <p>Robert had no friends</p>
                            <span class="memory-author">- His mother</span>
                        </div>
                        <div class="memory-card">
                            <div class="memory-icon">üéµ</div>
                            <h3>Joyful Moments</h3>
                            <p>The sound of his laughter could empty a room to anyone who heard it or smelled him. That big-back freak.</p>
                            <span class="memory-author">- Neighbor</span>
                        </div>
                        <div class="memory-card">
                            <div class="memory-icon">üåπ</div>
                            <h3>Love for Life</h3>
                            <p>The only thing Robert loved in life was steroids.</p>
                            <span class="memory-author">- Community Member</span>
                        </div>
                    </div>
                </section>

                <!-- Services Section -->
                <section id="services" class="section">
                    <h2 class="section-title">Memorial Services</h2>
                    <div class="services-content">
                        <div class="service-details">
                            <div class="service-card">
                                <h3>Visitation</h3>
                                <div class="service-info">
                                    <p><strong>Date:</strong> October 3, 2025</p>
                                    <p><strong>Time:</strong> 4:00 PM - 8:00 PM</p>
                                    <p><strong>Location:</strong> Sunset Memorial Funeral Home<br>1245 Memorial Drive, San Antonio, TX 78201</p>
                                </div>
                            </div>
                            
                            <div class="service-card">
                                <h3>Funeral Service</h3>
                                <div class="service-info">
                                    <p><strong>Date:</strong> October 4, 2025</p>
                                    <p><strong>Time:</strong> 11:00 AM</p>
                                    <p><strong>Location:</strong> St. Mary's Catholic Church<br>567 Oak Street, San Antonio, TX 78201</p>
                                </div>
                            </div>
                            
                            <div class="service-card">
                                <h3>Burial</h3>
                                <div class="service-info">
                                    <p><strong>Date:</strong> October 4, 2025</p>
                                    <p><strong>Time:</strong> 1:00 PM</p>
                                    <p><strong>Location:</strong> Peaceful Gardens Cemetery<br>890 Garden Lane, San Antonio, TX 78205</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="additional-info">
                            <h3>In Lieu of Flowers</h3>
                            <p>The family requests that donations be made to the American Cancer Society in Robert's memory.</p>
                            
                            <h3>Reception</h3>
                            <p>A reception will follow the service at the Parish Hall of St. Mary's Catholic Church. All are welcome to join the family in celebrating Robert's life and sharing memories together.</p>
                        </div>
                    </div>
                </section>

                <!-- Condolences Section -->
                <section id="condolences" class="section">
                    <h2 class="section-title">Condolences & Memories</h2>
                    
                    <!-- Add New Condolence Form -->
                    <div class="add-condolence-section">
                        <h3 style="text-align: center; margin-bottom: 1rem; color: var(--primary-color);">Share Your Memory</h3>
                        <p style="text-align: center; margin-bottom: 2rem; color: var(--text-muted); font-style: italic;">
                            Your message will be posted publicly on this memorial message board for all visitors to read and appreciate.
                        </p>
                        <div class="condolences-form">
                            <form id="condolencesForm">
                                <div class="form-group">
                                    <label for="condolenceName">Your Name</label>
                                    <input type="text" id="condolenceName" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label for="condolenceEmail">Email (optional)</label>
                                    <input type="email" id="condolenceEmail" name="email">
                                </div>
                                <div class="form-group">
                                    <label for="relationship">Relationship to Robert</label>
                                    <select id="relationship" name="relationship">
                                        <option value="">Select relationship</option>
                                        <option value="family">Family Member</option>
                                        <option value="friend">Friend</option>
                                        <option value="colleague">Colleague</option>
                                        <option value="neighbor">Neighbor</option>
                                        <option value="patient">Former Patient</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="condolenceMessage">Your Message</label>
                                    <textarea id="condolenceMessage" name="message" rows="5" placeholder="Share your memories, thoughts, or condolences..." required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Post to Message Board</button>
                            </form>
                        </div>
                    </div>

                    <!-- Condolences Blog Feed -->
                    <div class="condolences-blog">
                        <div class="blog-header">
                            <h3>Memorial Message Board</h3>
                            <p class="blog-subtitle">A public space where family, friends, and visitors can share memories, condolences, and stories about Robert. All messages are visible to everyone who visits this memorial.</p>
                        </div>
                        
                        <div class="condolences-feed" id="condolencesFeed">
                            <!-- Message board is ready for new submissions -->
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2025 In Loving Memory. With deepest sympathy and remembrance.</p>
            </div>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        // App Class - Main application controller
        class App {
            constructor() {
                this.currentSection = 'home';
                this.theme = localStorage.getItem('theme') || 'light';
                this.currentMediaIndex = 0;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initTheme();
                this.animateStats();
                this.showLoading();
                
                // Load existing messages from server
                this.loadMessagesFromServer();
                
                // Simulate app loading
                setTimeout(() => {
                    this.hideLoading();
                }, 1000);
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = e.target.dataset.section;
                        this.navigateToSection(section);
                    });
                });

                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => {
                    this.toggleTheme();
                });

                // Hero buttons
                document.getElementById('viewLife').addEventListener('click', () => {
                    this.navigateToSection('life');
                });

                document.getElementById('shareMemory').addEventListener('click', () => {
                    this.navigateToSection('photos');
                });

                // Condolences form
                document.getElementById('condolencesForm').addEventListener('submit', (e) => {
                    this.handleCondolencesForm(e);
                });

                // Gallery lightbox
                this.setupGalleryLightbox();

                // Smooth scrolling for mobile
                window.addEventListener('scroll', this.throttle(this.handleScroll.bind(this), 100));
            }

            navigateToSection(sectionId) {
                // Update active navigation link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

                // Show selected section
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');

                this.currentSection = sectionId;

                // Update URL without page reload
                history.pushState(null, null, `#${sectionId}`);
            }

            toggleTheme() {
                this.theme = this.theme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', this.theme);
                localStorage.setItem('theme', this.theme);
                
                // Update theme toggle button
                const themeToggle = document.getElementById('themeToggle');
                themeToggle.textContent = this.theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                
                // Add a little animation
                themeToggle.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    themeToggle.style.transform = 'scale(1)';
                }, 150);
            }

            initTheme() {
                document.documentElement.setAttribute('data-theme', this.theme);
                const themeToggle = document.getElementById('themeToggle');
                themeToggle.textContent = this.theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }

            animateStats() {
                const stats = document.querySelectorAll('.stat-number');
                
                const animateCount = (element) => {
                    const target = parseInt(element.dataset.target);
                    const duration = 2000; // 2 seconds
                    const step = target / (duration / 16); // 60fps
                    let current = 0;
                    
                    const timer = setInterval(() => {
                        current += step;
                        if (current >= target) {
                            current = target;
                            clearInterval(timer);
                        }
                        element.textContent = Math.floor(current);
                    }, 16);
                };

                // Animate stats when they come into view
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            animateCount(entry.target);
                            observer.unobserve(entry.target);
                        }
                    });
                });

                stats.forEach(stat => {
                    if (stat.id === 'wordsUsedStat') {
                        // Skip the normal animation for words used stat
                        this.startContinuousWordCounter(stat);
                    } else if (stat.id === 'friendsStat') {
                        // Skip the normal animation for friends stat
                        this.startDecreasingFriendsCounter(stat);
                    } else if (stat.id === 'patientsKilledStat') {
                        // Skip the normal animation for patients killed stat
                        this.startPatientsKilledCounter(stat);
                    } else {
                        observer.observe(stat);
                    }
                });
            }

            startContinuousWordCounter(element) {
                // Get saved value from localStorage or start at 569
                let currentCount = parseInt(localStorage.getItem('robertWordsUsed')) || 569;
                element.textContent = currentCount; // Set initial value
                
                const updateCounter = () => {
                    currentCount += 1; // Increment by exactly 1
                    element.textContent = currentCount;
                    // Save to localStorage
                    localStorage.setItem('robertWordsUsed', currentCount);
                };
                
                // Start the continuous counter when the element comes into view
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            // Update every 1000ms (1 second)
                            setInterval(updateCounter, 1000);
                            observer.unobserve(entry.target);
                        }
                    });
                });
                
                observer.observe(element);
            }

            startDecreasingFriendsCounter(element) {
                // Get saved value from localStorage or start at 5
                let currentCount = parseInt(localStorage.getItem('robertFriendsCount'));
                if (isNaN(currentCount)) {
                    currentCount = 5; // Default starting value
                }
                element.textContent = currentCount; // Set initial value
                
                const updateCounter = () => {
                    currentCount -= 1; // Decrease by exactly 1 (no restrictions)
                    element.textContent = currentCount;
                    // Save to localStorage
                    localStorage.setItem('robertFriendsCount', currentCount);
                };
                
                // Start the decreasing counter when the element comes into view
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            // Update every 10000ms (10 seconds) - no restrictions
                            setInterval(updateCounter, 10000);
                            observer.unobserve(entry.target);
                        }
                    });
                });
                
                observer.observe(element);
            }

            startPatientsKilledCounter(element) {
                // Get saved value from localStorage or start at 500
                let currentCount = parseInt(localStorage.getItem('robertPatientsKilled')) || 500;
                element.textContent = currentCount; // Set initial value
                
                const updateCounter = () => {
                    currentCount += 1; // Increment by exactly 1
                    element.textContent = currentCount;
                    // Save to localStorage
                    localStorage.setItem('robertPatientsKilled', currentCount);
                };
                
                // Start the counter when the element comes into view
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            // Update every 25000ms (25 seconds)
                            setInterval(updateCounter, 25000);
                            observer.unobserve(entry.target);
                        }
                    });
                });
                
                observer.observe(element);
            }

            setupGalleryLightbox() {
                const galleryItems = document.querySelectorAll('.gallery-item');
                const lightboxModal = document.getElementById('lightboxModal');
                const lightboxImage = document.getElementById('lightboxImage');
                const lightboxVideo = document.getElementById('lightboxVideo');
                const lightboxClose = document.getElementById('lightboxClose');
                const lightboxPrev = document.getElementById('lightboxPrev');
                const lightboxNext = document.getElementById('lightboxNext');
                const lightboxCounter = document.getElementById('lightboxCounter');

                let currentIndex = 0;
                const mediaItems = Array.from(galleryItems);

                // Open lightbox when gallery item is clicked
                galleryItems.forEach((item, index) => {
                    item.addEventListener('click', () => {
                        currentIndex = index;
                        openLightbox();
                    });
                });

                // Close lightbox
                lightboxClose.addEventListener('click', closeLightbox);
                lightboxModal.addEventListener('click', (e) => {
                    if (e.target === lightboxModal) {
                        closeLightbox();
                    }
                });

                // Navigation
                lightboxPrev.addEventListener('click', () => {
                    currentIndex = (currentIndex - 1 + mediaItems.length) % mediaItems.length;
                    showMedia();
                });

                lightboxNext.addEventListener('click', () => {
                    currentIndex = (currentIndex + 1) % mediaItems.length;
                    showMedia();
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (!lightboxModal.classList.contains('active')) return;
                    
                    if (e.key === 'Escape') {
                        closeLightbox();
                    } else if (e.key === 'ArrowLeft') {
                        currentIndex = (currentIndex - 1 + mediaItems.length) % mediaItems.length;
                        showMedia();
                    } else if (e.key === 'ArrowRight') {
                        currentIndex = (currentIndex + 1) % mediaItems.length;
                        showMedia();
                    }
                });

                function openLightbox() {
                    lightboxModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    showMedia();
                }

                function closeLightbox() {
                    lightboxModal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                    lightboxImage.style.display = 'none';
                    lightboxVideo.style.display = 'none';
                    if (lightboxVideo.src) {
                        lightboxVideo.pause();
                    }
                }

                function showMedia() {
                    const currentItem = mediaItems[currentIndex];
                    const src = currentItem.dataset.src;
                    const isVideo = currentItem.classList.contains('video-item');

                    lightboxCounter.textContent = `${currentIndex + 1} / ${mediaItems.length}`;

                    if (isVideo) {
                        lightboxImage.style.display = 'none';
                        lightboxVideo.style.display = 'block';
                        lightboxVideo.src = src;
                    } else {
                        lightboxVideo.style.display = 'none';
                        lightboxImage.style.display = 'block';
                        lightboxImage.src = src;
                    }
                }
            }

            handleCondolencesForm(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    relationship: formData.get('relationship'),
                    message: formData.get('message')
                };

                this.showLoading();

                // Send to server
                this.saveMessageToServer(data)
                    .then((savedMessage) => {
                        this.hideLoading();
                        
                        // Add the new condolence to the blog
                        this.addCondolencePost(savedMessage);
                        
                        // Show success message
                        this.showNotification('Your message has been saved and posted to the memorial message board!', 'success');
                        
                        // Reset form
                        e.target.reset();
                        
                        // Scroll to the new post
                        setTimeout(() => {
                            document.querySelector('.condolences-feed').firstElementChild.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                        }, 500);
                    })
                    .catch((error) => {
                        this.hideLoading();
                        console.error('Error saving message:', error);
                        this.showNotification('Error saving your message. Please try again.', 'error');
                    });
            }

            async saveMessageToServer(data) {
                try {
                    // Detect if we're on Netlify or local development
                    const isNetlify = window.location.hostname.includes('netlify') || window.location.hostname.includes('vercel');
                    const apiBase = isNetlify ? '' : ''; // Use relative paths for both
                    
                    const response = await fetch('/api/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }

                    const result = await response.json();
                    return result.message;
                } catch (error) {
                    console.error('Error sending message to server:', error);
                    throw error;
                }
            }

            async loadMessagesFromServer() {
                try {
                    const response = await fetch('/api/messages');
                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    const messages = await response.json();
                    
                    // Display existing messages
                    messages.forEach(message => {
                        this.addCondolencePost(message, false); // false = don't animate
                    });
                } catch (error) {
                    console.error('Error loading messages from server:', error);
                    // Fall back to showing a message
                    this.showNotification('Unable to load existing messages from server.', 'info');
                }
            }

            addCondolencePost(data, animate = true) {
                const feed = document.getElementById('condolencesFeed');
                
                // Create new post element
                const postElement = document.createElement('div');
                postElement.className = 'condolence-post';
                postElement.dataset.messageId = data.id || '';
                
                if (animate) {
                    postElement.style.opacity = '0';
                    postElement.style.transform = 'translateY(20px)';
                }
                
                // Get appropriate avatar based on relationship
                const avatarMap = {
                    'family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                    'friend': 'üë•',
                    'colleague': 'üë©‚Äç‚öïÔ∏è',
                    'neighbor': 'üè†',
                    'patient': 'üè•',
                    'other': 'üíô'
                };
                
                const avatar = avatarMap[data.relationship] || 'üíô';
                const relationshipText = data.relationship ? data.relationship.charAt(0).toUpperCase() + data.relationship.slice(1) : 'Friend';
                
                // Format date
                let dateText = 'Just now';
                if (data.timestamp) {
                    const messageDate = new Date(data.timestamp);
                    const now = new Date();
                    const diffMs = now - messageDate;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    if (diffMins < 1) {
                        dateText = 'Just now';
                    } else if (diffMins < 60) {
                        dateText = `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
                    } else if (diffHours < 24) {
                        dateText = `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
                    } else if (diffDays < 7) {
                        dateText = `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
                    } else {
                        dateText = messageDate.toLocaleDateString();
                    }
                }
                
                postElement.innerHTML = `
                    <div class="post-header">
                        <div class="post-author">
                            <div class="author-avatar">${avatar}</div>
                            <div class="author-info">
                                <h4>${this.escapeHtml(data.name)}</h4>
                                <span class="author-relationship">${relationshipText}</span>
                            </div>
                        </div>
                        <div class="post-date">${dateText}</div>
                    </div>
                    <div class="post-content">
                        <p>${this.escapeHtml(data.message).replace(/\n/g, '<br>')}</p>
                    </div>
                    <div class="post-footer">
                        <button class="like-btn" onclick="likePost(this)" data-message-id="${data.id || ''}">
                            <span class="heart">‚ù§Ô∏è</span> 
                            <span class="like-count">${data.likes || 0}</span>
                        </button>
                    </div>
                `;
                
                // Insert at the beginning of the feed
                feed.insertBefore(postElement, feed.firstChild);
                
                // Animate in if requested
                if (animate) {
                    setTimeout(() => {
                        postElement.style.opacity = '1';
                        postElement.style.transform = 'translateY(0)';
                    }, 100);
                }
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                
                // Add styles
                const colors = {
                    'success': '#28a745',
                    'error': '#dc3545',
                    'info': '#17a2b8'
                };
                
                Object.assign(notification.style, {
                    position: 'fixed',
                    top: '20px',
                    right: '20px',
                    padding: '1rem 1.5rem',
                    borderRadius: '8px',
                    color: 'white',
                    backgroundColor: colors[type] || colors['info'],
                    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                    zIndex: '10000',
                    opacity: '0',
                    transform: 'translateX(100%)',
                    transition: 'all 0.3s ease',
                    maxWidth: '300px',
                    wordWrap: 'break-word'
                });
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.style.opacity = '1';
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            showLoading() {
                document.getElementById('loadingOverlay').classList.add('active');
            }

            hideLoading() {
                document.getElementById('loadingOverlay').classList.remove('active');
            }

            handleScroll() {
                const header = document.querySelector('.header');
                if (window.scrollY > 50) {
                    header.style.boxShadow = '0 2px 10px var(--shadow-color)';
                } else {
                    header.style.boxShadow = 'none';
                }
            }

            // Utility function to throttle function calls
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new App();
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', () => {
            const hash = window.location.hash.slice(1) || 'home';
            if (window.app) {
                window.app.navigateToSection(hash);
            }
        });

        // Global function for like button functionality
        async function likePost(button) {
            const messageId = button.dataset.messageId;
            const likeCountSpan = button.querySelector('.like-count');
            const currentCount = parseInt(likeCountSpan.textContent);
            const isLiked = button.classList.contains('liked');
            
            if (isLiked) {
                // Unlike - for now, just toggle locally (could implement unlike on server)
                button.classList.remove('liked');
                likeCountSpan.textContent = Math.max(0, currentCount - 1);
            } else {
                // Like
                if (messageId) {
                    try {
                        const response = await fetch(`/api/messages/${messageId}/like`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            button.classList.add('liked');
                            likeCountSpan.textContent = result.likes;
                            
                            // Add heart animation
                            const heart = button.querySelector('.heart');
                            heart.style.animation = 'heartBeat 0.3s ease';
                            setTimeout(() => {
                                heart.style.animation = '';
                            }, 300);
                        } else {
                            console.error('Failed to like message');
                        }
                    } catch (error) {
                        console.error('Error liking message:', error);
                        // Fall back to local behavior
                        button.classList.add('liked');
                        likeCountSpan.textContent = currentCount + 1;
                    }
                } else {
                    // No message ID, just toggle locally
                    button.classList.add('liked');
                    likeCountSpan.textContent = currentCount + 1;
                    
                    // Add heart animation
                    const heart = button.querySelector('.heart');
                    heart.style.animation = 'heartBeat 0.3s ease';
                    setTimeout(() => {
                        heart.style.animation = '';
                    }, 300);
                }
            }
        }

        // Restore liked states on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.querySelectorAll('.condolence-post').forEach(post => {
                    const authorName = post.querySelector('.author-info h4').textContent;
                    const likeKey = `liked_${authorName.replace(/\s+/g, '_')}`;
                    const isLiked = localStorage.getItem(likeKey) === 'true';
                    
                    if (isLiked) {
                        const likeBtn = post.querySelector('.like-btn');
                        likeBtn.classList.add('liked');
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
